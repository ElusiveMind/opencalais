<?php

class CalaisGeoBase extends DrupalWebTestCase {

	function setUp() {
		parent::setUp('calais_api', 'calais', 'geonames', 'calais_geo');
		
		// Create and login user
    $admin_user = $this->drupalCreateUser();
    $this->drupalLogin($admin_user);
	}

	function tearDown() {
		parent::tearDown();
	}

}

class CalaisGeoLookupTestCase extends CalaisGeoBase {

  function getInfo() {
    return array(
      'name' => t('Lat/Lon Lookup'),
      'description' => t('Test the various lookup options for latitude and longitude of terms.'),
      'group' => t('Calais')
    );
  }

	// Test filling in an existing terms guid
	function testLookup() {
		$vid = 999;
		$node = $this->drupalCreateNode();
		$term = "West Islip";

		// Case 1: No term exists
		$data = calais_geo_get_latlon($node, $term);
		$this->assertEqual($data['lat'], '40.7062104');
		$this->assertEqual($data['lon'], '-73.3062302');		
		
		// Case 2: Term exists WITHOUT no geo data
		$calais_term = new CalaisTerm($this->randomName(100), $term, 0.5);
		$tid = calais_get_calais_term($vid, $calais_term);
		calais_assign_node_calaisterm($node->nid, $tid, 1.0);
		
		$data = calais_geo_get_latlon($node, $term);
		$this->assertEqual($data['lat'], '40.7062104');
		$this->assertEqual($data['lon'], '-73.3062302');		
		
		// Case 3: Term exists WITH geo data
		$calais_term->lat = '99.6666';
		$calais_term->lon = '-120.54321';
		$tid = calais_get_calais_term($vid, $calais_term);
		calais_assign_node_calaisterm($node->nid, $tid, 1.0);
		
		$data = calais_geo_get_latlon($node, $term);
		$this->assertEqual($data['lat'], '99.6666');
		$this->assertEqual($data['lon'], '-120.54321');		
	}
}
